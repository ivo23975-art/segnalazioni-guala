<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <title>SuperAdmin ‚Äì Gestione Accessi</title>

    <link rel="stylesheet" href="dashboard.css">

    <style>
        body {
            background:#111;
            color:#eee;
            font-family:system-ui, sans-serif;
            margin:0;
            padding:20px;
        }
        h1 {
            text-align:center;
            margin-bottom:20px;
            color:#cc0000;
        }
        .box {
            background:#1c1c1c;
            padding:20px;
            border-radius:10px;
            max-width:650px;
            margin:0 auto 25px auto;
        }
        label {
            margin-top:10px;
            display:block;
            font-weight:bold;
        }
        input, select {
            width:100%;
            padding:10px;
            border-radius:6px;
            border:none;
            background:#2c2c2c;
            color:#fff;
            margin-top:5px;
        }
        button {
            width:100%;
            padding:12px;
            background:#cc0000;
            border:none;
            margin-top:20px;
            border-radius:6px;
            color:#fff;
            font-weight:bold;
            cursor:pointer;
        }
        .logout-btn {
            background:#444;
        }
        .role-title {
            font-size:1.3rem;
            margin:25px 0 10px 0;
            color:#cc0000;
        }
    </style>
</head>

<body>

<h1>SuperAdmin ‚Äì Gestione Accessi Amministratori</h1>

<div class="box">

    <p>Gestisci accessi admin (username + password + modalit√†).</p>

    <hr style="margin:20px 0; border-color:#333">

    <div id="adminSettingsContainer"></div>

    <button onclick="saveAll()">üíæ Salva Modifiche</button>

    <button class="logout-btn" onclick="adminLogout()">Esci dal pannello</button>

</div>

<script src="admin-auth.js"></script>

<script>

requireRole("superadmin");

function renderSettings() {
    const container = document.getElementById("adminSettingsContainer");
    container.innerHTML = "";

    for (const key in ADMIN_DATA) {
        const a = ADMIN_DATA[key];

        container.innerHTML += `
            <div class="role-title">üîê ${a.role.toUpperCase()}</div>

            <label>Modalit√† di login</label>
            <select id="mode_${key}">
                <option value="password" ${a.loginMode === "password" ? "selected" : ""}>Solo password</option>
                <option value="userpass" ${a.loginMode === "userpass" ? "selected" : ""}>Username + Password</option>
            </select>

            <div id="userbox_${key}" style="display:${a.loginMode === "userpass" ? "block" : "none"};">
                <label>Username</label>
                <input type="text" id="user_${key}" value="${a.username}">
            </div>

            <label>Password</label>
            <input type="text" id="pass_${key}" value="${a.password}">

            <hr style="margin:20px 0; border-color:#333">
        `;
    }

    for (const key in ADMIN_DATA) {
        document.getElementById(`mode_${key}`).addEventListener("change", e => {
            document.getElementById(`userbox_${key}`).style.display =
                e.target.value === "userpass" ? "block" : "none";
        });
    }
}

function saveAll() {

    let newData = {};

    for (const key in ADMIN_DATA) {
        const mode = document.getElementById(`mode_${key}`).value;
        const user = document.getElementById(`user_${key}`)?.value || "";
        const pass = document.getElementById(`pass_${key}`).value;

        if (pass.length < 4) {
            alert("La password deve avere almeno 4 caratteri.");
            return;
        }

        newData[key] = {
            role: ADMIN_DATA[key].role,
            loginMode: mode,
            username: user,
            password: pass
        };
    }

    saveAdminConfig(newData);
    alert("Modifiche salvate correttamente!");
}

renderSettings();

</script>

</body>
</html>
