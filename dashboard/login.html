<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <title>Login Amministratori</title>
    <link rel="stylesheet" href="dashboard.css">

    <style>
        body {
            background:#111;
            color:#eee;
            font-family: system-ui, sans-serif;
            display:flex;
            justify-content:center;
            align-items:center;
            height:100vh;
            margin:0;
        }
        .login-box {
            background:#1c1c1c;
            padding:30px;
            border-radius:10px;
            width:90%;
            max-width:360px;
            box-shadow:0 0 20px rgba(0,0,0,.4);
        }
        h2 {
            text-align:center;
            margin-bottom:20px;
        }
        select, input {
            width:100%;
            padding:10px;
            margin-top:10px;
            border-radius:6px;
            border:none;
            background:#2c2c2c;
            color:#fff;
        }
        button {
            margin-top:20px;
            width:100%;
            padding:12px;
            background:#cc0000;
            border:none;
            border-radius:6px;
            color:#fff;
            font-weight:bold;
            cursor:pointer;
        }
    </style>
</head>

<body>

<div class="login-box">
    <h2>Accesso Amministratori</h2>

    <label>Ruolo</label>
    <select id="roleSelect" onchange="updateLoginMode()">
        <option value="guala">Admin Guala</option>
        <option value="piobesi">Admin Piobesi</option>
        <option value="particomuni">Admin Parti Comuni</option>
        <option value="superadmin">SuperAdmin</option>
    </select>

    <div id="usernameWrapper" style="display:none;">
        <label>Username</label>
        <input type="text" id="usernameInput" placeholder="Inserisci username">
    </div>

    <label>Password</label>
    <input type="password" id="passwordInput" placeholder="Inserisci password">

    <button onclick="doLogin()">Entra</button>

    <p id="errorMsg" style="color:#ff4444; margin-top:10px; text-align:center;"></p>
</div>

<!-- AUTH SYSTEM -->
<script src="admin-auth.js"></script>

<script>

/* =====================================================
   MOSTRA O NASCONDE USERNAME IN BASE AL RUOLO
===================================================== */
function updateLoginMode() {
    const role = document.getElementById("roleSelect").value;
    const loginMode = ADMIN_DATA[role].loginMode;

    if (loginMode === "userpass") {
        document.getElementById("usernameWrapper").style.display = "block";
    } else {
        document.getElementById("usernameWrapper").style.display = "none";
    }
}

/* =====================================================
   ESECUZIONE LOGIN
===================================================== */
function doLogin() {

    const role = document.getElementById("roleSelect").value;
    const username = document.getElementById("usernameInput").value;
    const password = document.getElementById("passwordInput").value;

    const success = adminLogin(role, username, password);

    if (!success) {
        document.getElementById("errorMsg").innerText = "Credenziali non valide.";
        return;
    }

    // Login OK â†’ reindirizza in base al ruolo
    if (role === "superadmin") window.location.href = "superadmin.html";
    if (role === "guala") window.location.href = "guala.html";
    if (role === "piobesi") window.location.href = "piobesi.html";
    if (role === "particomuni") window.location.href = "particomuni.html";
}

// Inizializza UI in base al ruolo predefinito
updateLoginMode();

</script>

</body>
</html>
