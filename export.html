<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<title>Esportazione Segnalazioni</title>
<link rel="stylesheet" href="export.css">
</head>

<body>

<div id="header">
    <h1 id="title">Report Segnalazioni</h1>
    <p id="subtitle"></p>
    <p id="date"></p>
</div>

<table id="reportTable">
    <thead>
        <tr>
            <th>Data</th>
            <th>Scala</th>
            <th>Piano</th>
            <th>Lato</th>
            <th>Nome</th>
            <th>Temp</th>
            <th>Tipo</th>
            <th>Descrizione</th>
            <th>Stato</th>
        </tr>
    </thead>
    <tbody></tbody>
</table>

<script>
/* ===== LETTURA DATI DA LOCALSTORAGE ===== */

const json = localStorage.getItem("exportData");
if (!json) {
    alert("Errore: nessun dato ricevuto.");
} else {
    const data = JSON.parse(json);

    // intestazioni
    document.getElementById("subtitle").innerText =
        "Complesso: " + data.complesso.toUpperCase();

    document.getElementById("date").innerText =
        "Generato il: " + new Date().toLocaleString();

    document.documentElement.style.setProperty(
        "--main-color",
        data.colore
    );

    const tbody = document.querySelector("#reportTable tbody");

    data.rows.forEach(r => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
            <td>${r.timestamp}</td>
            <td>${r.scala}</td>
            <td>${r.piano}</td>
            <td>${r.lato}</td>
            <td>${r.nome}</td>
            <td>${r.temperatura}</td>
            <td>${r.tipo}</td>
            <td>${r.descrizione}</td>
            <td>${r.stato}</td>
        `;
        tbody.appendChild(tr);
    });

    // stampa ritardata per sicurezza
    setTimeout(() => window.print(), 400);
}
</script>

</body>
</html>
